<?xml version="1.0" encoding="UTF-8"?>
<Policy xmlns="urn:oasis:names:tc:xacml:4.0:core:schema"
    xmlns:xpath="urn:oasis:names:tc:xacml:4.0:xpath:schema"
    xmlns:md="urn:example:med:schemas:record"
    PolicyId="urn:oasis:names:tc:acal:1.0:example:policyid:2" Version="1.0"
    CombiningAlgId="urn:oasis:names:tc:acal:1.0:combining-algorithm:deny-overrides">
    <xpath:XPathPolicyDefaults XPathVersion="https://www.w3.org/TR/xpath20/" />
    <VariableDefinition
        VariableId="patient_under_16">
        <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:date-less-or-equal">
            <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:date-one-and-only">
                <AttributeDesignator
                    Category="urn:oasis:names:tc:acal:1.0:attribute-category:environment"
                    AttributeId="urn:oasis:names:tc:acal:1.0:environment:current-date"/>
            </Apply>
            <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:date-add-yearMonthDuration">
                <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:date-one-and-only">
                    <xpath:XPathAttributeSelector
                        Category="urn:oasis:names:tc:acal:1.0:attribute-category:resource"
                        Path="md:record/md:patient/md:patientDoB/text()"/>
                </Apply>
                <Value>P16Y</Value>
            </Apply>
        </Apply>
    </VariableDefinition>
    <Rule Id="example_rule_2" Effect="Permit">
        <Description>A person may read any medical record in the urn:example:med:schemas:record
            namespace for which he or she is the designated parent or guardian, and for which the
            patient is under 16 years of age</Description>
        <Condition>
            <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:and">
                <VariableReference VariableId="patient_under_16" />
                <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:string-is-in">
                    <Value>read</Value>
                    <AttributeDesignator
                        Category="urn:oasis:names:tc:acal:1.0:attribute-category:action"
                        AttributeId="urn:oasis:names:tc:acal:1.0:action:action-id" />
                </Apply>
                <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:anyURI-is-in">
                    <Value>urn:example:med:schemas:record</Value>
                    <AttributeDesignator
                        Category="urn:oasis:names:tc:acal:1.0:attribute-category:resource"
                        AttributeId="urn:oasis:names:tc:acal:1.0:resource:target-namespace"/>
                </Apply>
                <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:any-of">
                    <Function Id="urn:oasis:names:tc:acal:1.0:function:xpath-node-match" />
                    <Value
                        XPathCategory="urn:oasis:names:tc:acal:1.0:attribute-category:resource" XPath="md:record" />
                    <AttributeDesignator
                        Category="urn:oasis:names:tc:acal:1.0:attribute-category:resource"
                        AttributeId="urn:oasis:names:tc:acal:1.0:content-selector"/>
                </Apply>
                <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:string-equal">
                    <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:string-one-and-only">
                        <AttributeDesignator
                            Category="urn:oasis:names:tc:acal:1.0:subject-category:access-subject"
                            AttributeId="urn:oasis:names:tc:acal:1.0:example:attribute:physician-id" />
                    </Apply>
                    <Apply FunctionId="urn:oasis:names:tc:acal:1.0:function:string-one-and-only">
                        <xpath:XPathAttributeSelector
                            Category="urn:oasis:names:tc:acal:1.0:attribute-category:resource"
                            Path="md:record/md:parentGuardian/md:parentGuardianId/text()" />
                    </Apply>
                </Apply>
            </Apply>
        </Condition>
    </Rule>
</Policy>